<!--pages/practice/index.wxml-->
<scroll-view class="scroll-container" scroll-y="true">
  <view class="container">
    <!-- é¢˜ç›®åˆ—è¡¨é¡µé¢ -->
    <view class="list-page" wx:if="{{pageState === 'list'}}">
      <!-- é¡µé¢å¤´éƒ¨ -->
      <view class="header">
        <view class="header-content">
          <view class="header-left">
            <text class="page-title">SQLç»ƒä¹ é¢˜</text>
            <text class="page-subtitle">é€šè¿‡ç»ƒä¹ æå‡SQLæŠ€èƒ½</text>
          </view>
          <view class="progress-info">
            <text class="progress-text">{{userProgress.completed}}/{{userProgress.total}}</text>
            <text class="progress-rate">{{userProgress.total > 0 ? Math.round(userProgress.correct / userProgress.total * 100) : 0}}%</text>
          </view>
        </view>
      </view>

      <!-- è¿›åº¦å¡ç‰‡ -->
      <view class="progress-card card">
        <view class="progress-header">
          <text class="progress-title">å­¦ä¹ è¿›åº¦</text>
          <text class="progress-subtitle">ç»§ç»­åŠ æ²¹ï¼Œæå‡æŠ€èƒ½ï¼</text>
        </view>
        <view class="progress-stats">
          <view class="progress-item">
            <text class="progress-number">{{userProgress.total}}</text>
            <text class="progress-label">æ€»é¢˜æ•°</text>
          </view>
          <view class="progress-item">
            <text class="progress-number">{{userProgress.completed}}</text>
            <text class="progress-label">å·²å®Œæˆ</text>
          </view>
          <view class="progress-item">
            <text class="progress-number">{{userProgress.correct}}</text>
            <text class="progress-label">æ­£ç¡®æ•°</text>
          </view>
          <view class="progress-item">
            <text class="progress-number">{{userProgress.total > 0 ? Math.round(userProgress.correct / userProgress.total * 100) : 0}}%</text>
            <text class="progress-label">æ­£ç¡®ç‡</text>
          </view>
        </view>
      </view>

      <!-- åˆ†ç±»ç­›é€‰ -->
      <view class="categories-section">
        <view class="section-title">é¢˜ç›®åˆ†ç±»</view>
        <scroll-view class="categories-scroll" scroll-x="true">
          <view class="categories-list">
            <view 
              class="category-item {{currentCategory === item.id ? 'active' : ''}}"
              wx:for="{{categories}}"
              wx:key="id"
              data-category="{{item.id}}"
              bindtap="switchCategory"
            >
              <text class="category-name">{{item.name}}</text>
              <text class="category-count">{{item.count}}</text>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- é¢˜ç›®åˆ—è¡¨ -->
      <view class="questions-section">
        <view class="section-title">é¢˜ç›®åˆ—è¡¨</view>
        <view class="questions-list">
          <view 
            class="question-card card"
            wx:for="{{getCurrentQuestions()}}"
            wx:key="id"
            data-id="{{item.id}}"
            bindtap="viewQuestion"
          >
            <view class="question-row">
              <text class="question-title">{{item.title}}</text>
              <view class="question-tags">
                <text class="tag difficulty-{{item.difficulty}}">
                  {{item.difficulty === 1 ? 'ç®€å•' : item.difficulty === 2 ? 'ä¸­ç­‰' : 'å›°éš¾'}}
                </text>
                <text class="tag status-{{item.completed ? (item.correct ? 'correct' : 'incorrect') : 'pending'}}">
                  {{item.completed ? (item.correct ? 'âœ“' : 'âœ—') : 'â—‹'}}
                </text>
              </view>
            </view>
            <text class="question-desc single-line">{{item.description}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- é¢˜ç›®è¯¦æƒ…é¡µé¢ -->
    <view class="detail-page" wx:if="{{pageState === 'detail'}}">
      <view class="detail-header-simple">
        <text class="back-icon" bindtap="backToList">â†</text>
        <text class="detail-title">{{currentQuestion.title}}</text>
      </view>
      <view class="practice-detail card">
        <view class="practice-desc">{{currentQuestion.description}}</view>
        <textarea class="practice-input" value="{{userAnswer}}" placeholder="è¯·è¾“å…¥SQLè¯­å¥..." bindinput="onAnswerInput" auto-height />
        <view class="practice-actions">
          <button class="btn-primary" bindtap="submitAnswer">æäº¤</button>
          <button class="btn-link" bindtap="showAnswer">å‚è€ƒç­”æ¡ˆ</button>
        </view>
        <view class="practice-answer" wx:if="{{showAnswer}}">
          <text class="answer-label">å‚è€ƒç­”æ¡ˆï¼š</text>
          <text class="answer-sql">{{currentQuestion.sql}}</text>
          <text class="answer-explanation">{{currentQuestion.explanation}}</text>
        </view>
      </view>
    </view>

    <!-- ç­”é¢˜ç»“æœé¡µé¢ -->
    <view class="result-page" wx:if="{{pageState === 'result'}}">
      <view class="result-header">
        <button class="back-btn" bindtap="backToList">
          <text class="back-icon">â†</text>
          è¿”å›åˆ—è¡¨
        </button>
        <text class="result-title">ç­”é¢˜ç»“æœ</text>
      </view>

      <view class="result-card card">
        <view class="result-icon {{answerResult.correct ? 'correct' : 'incorrect'}}">
          <text class="result-symbol">{{answerResult.correct ? 'âœ“' : 'âœ—'}}</text>
        </view>
        
        <view class="result-content">
          <text class="result-message">{{answerResult.message}}</text>
          
          <view class="result-details" wx:if="{{!answerResult.correct}}">
            <text class="result-label">ä½ çš„ç­”æ¡ˆï¼š</text>
            <text class="result-user-answer">{{userAnswer}}</text>
            
            <text class="result-label">å‚è€ƒç­”æ¡ˆï¼š</text>
            <text class="result-correct-answer">{{answerResult.expected}}</text>
          </view>
          
          <view class="result-explanation" wx:if="{{currentQuestion.explanation}}">
            <text class="result-label">è§£æï¼š</text>
            <text class="result-explanation-text">{{currentQuestion.explanation}}</text>
          </view>
        </view>
      </view>

      <view class="result-actions">
        <button class="btn btn-secondary" bindtap="retry">
          <text class="btn-icon">ğŸ”„</text>
          é‡æ–°ç­”é¢˜
        </button>
        <button class="btn btn-primary" bindtap="nextQuestion">
          <text class="btn-icon">â†’</text>
          ä¸‹ä¸€é¢˜
        </button>
      </view>
    </view>

    <view class="top-bar">
      <button class="nav-btn" open-type="navigateBack">è¿”å›</button>
      <text class="title">SQLç»ƒä¹ </text>
    </view>
    <view class="practice-section">
      <picker mode="selector" range="{{practiceCategories}}" bindchange="onCategoryChange">
        <view class="picker">å½“å‰åˆ†ç±»ï¼š{{selectedCategory}}</view>
      </picker>
      <text class="desc">è¯·é€‰æ‹©ç»ƒä¹ é¢˜ç›®ï¼š</text>
      <picker mode="selector" range="{{practiceList}}" bindchange="onPracticeChange">
        <view class="picker">å½“å‰é¢˜ç›®ï¼š{{currentPractice}}</view>
      </picker>
      <textarea class="sql-textarea" value="{{sqlText}}" placeholder="è¯·è¾“å…¥SQLè¯­å¥..." bindinput="onSqlInput" auto-height />
      <view class="editor-actions">
        <button type="primary" bindtap="onExecute">æ‰§è¡ŒSQL</button>
      </view>
    </view>
  </view>
</scroll-view>